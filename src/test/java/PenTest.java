import org.testng.annotations.AfterMethod;
import org.testng.annotations.BeforeMethod;
import org.testng.annotations.DataProvider;
import org.testng.annotations.Test;

import java.io.ByteArrayOutputStream;
import java.io.PrintStream;

import static java.lang.System.lineSeparator;
import static org.testng.AssertJUnit.assertEquals;

public class PenTest {
    private Pen pen;
    private ByteArrayOutputStream outContent;
    private final PrintStream originalOut = System.out;

    //constructor1
    @DataProvider(name = "Pen_createObjWithInkValidArgs")
    public Object[][] providePen_createObjWithInkValidArgs() {
        return new Object[][] {
                {1},
                {0},
                {10}
        };
    }

    @Test(dataProvider = "Pen_createObjWithInkValidArgs")
    public void testPenPen_createObjWithInkValidArgs(int inkCV) throws Exception{
        pen = new Pen(inkCV);
    }

    @DataProvider(name = "Pen_createObjWithInkInvalidArgs")
    public Object[][] providePen_createObjWithInkInvalidArgs() {
        return new Object[][] {
                {null},
                {-10},
                {-19}
        };
    }

    @Test(dataProvider = "Pen_createObjWithInkInvalidArgs", expectedExceptions = IllegalArgumentException.class)
    public void testPenPen_createObjWithInkInvalidArgs(int inkCV) throws Exception{
        pen = new Pen(inkCV);
    }


    //constructor2
    @DataProvider(name = "Pen_createObjWithSizeLetterValidArgs")
    public Object[][] providePen_createObjWithSizeLetterValidArgs() {
        return new Object[][] {
                {1,3},
                {2,0.01},
                {0,5}
        };
    }

    @Test(dataProvider = "Pen_createObjWithSizeLetterValidArgs")
    public void testPenPen_createObjWithSizeLetterValidArgs(int inkCV, double sl) throws Exception{
        pen = new Pen(inkCV,sl);
    }

    @DataProvider(name = "Pen_createObjWithSizeLetterInvalidArgs")
    public Object[][] providePen_createObjWithSizeLetterInvalidArgs() {
        return new Object[][] {
                {-1,3},
                {2,-3},
                {2,0},
                {null,1},
                {2, null},
                {null, 0}
        };
    }

    @Test(dataProvider = "Pen_createObjWithSizeLetterInvalidArgs", expectedExceptions = IllegalArgumentException.class)
    public void testPenPen_createObjWithSizeLetterInvalidArgs(int inkCV, double sl) throws Exception{
        pen = new Pen(inkCV,sl);
    }

    //constructor3
    @DataProvider(name = "Pen_createObjWithColorValidArgs")
    public Object[][] providePen_createObjWithColorValidArgs() {
        return new Object[][] {
                {1,1, "RED"},
                {2,0.01,"BLUE"},
                {0,5,"GREEN"}
        };
    }

    @Test(dataProvider = "Pen_createObjWithColorValidArgs")
    public void testPenPen_createObjWithColorValidArgs(int inkCV, double sl, String color) throws Exception{
        pen = new Pen(inkCV,sl,color);
    }

    @DataProvider(name = "Pen_createObjWithColorInvalidArgs")
    public Object[][] providePen_createObjWithColorInvalidArgs() {
        return new Object[][] {
                {-1,1, "RED"},
                {0,5,"BLUE"},
                {null,7,"GREEN"},
                {2,0,"GREEN"},
                {2,-8,"GREEN"},
                {2,0,null},
        };
    }

    @Test(dataProvider = "Pen_createObjWithColorInvalidArgs", expectedExceptions = IllegalArgumentException.class)
    public void testPenPen_createObjWithColorInvalidArgs(int inkCV, double sl, String color) throws Exception{
        pen = new Pen(inkCV,sl,color);
    }


    //write
    @DataProvider(name = "write_writeWord")
    public Object[][] provideWrite_writeWord() {
        return new Object[][] {
                {10, 1, "RED","word"},
                {24,3,"RED", "can"},
                {20, 2,"BLUE","card"}
        };
    }

    @Test(dataProvider = "write_writeWord")
    public void testPenWrite_writeWord(int inkCV, double sl, String color, String word) {
        pen = new Pen(inkCV, sl,color);
        assertEquals("Success", word, pen.write(word));
    }

    @DataProvider(name = "write_writePartOfWord")
    public Object[][] provideWrite_writePartOfWord() {
        return new Object[][] {
                {3, 1, "RED","word", "wor"},
                {1,3,"RED", "can","c"},
                {2, 2,"BLUE","card","ca"}
        };
    }

    @Test(dataProvider = "write_writePartOfWord")
    public void testPenWrite_writePartOfWord(int inkCV, double sl, String color, String word, String res) {
        pen = new Pen(inkCV, sl,color);
        assertEquals("Success", res, pen.write(word));
    }
    @DataProvider(name = "write_penNotWorking")
    public Object[][] provideWrite_penNotWorking() {
        return new Object[][] {
                {-2, 1, "RED","word"},
                {-6,3,"RED", "can"},
                {0, 2,"BLUE","card"}
        };
    }

    @Test(dataProvider = "write_penNotWorking")
    public void testPenWrite_penNotWorking(int inkCV, double sl, String color, String word) {
        pen = new Pen(inkCV, sl,color);
        assertEquals("Success", "", pen.write(word));
    }

    @DataProvider(name = "write_NullBehaviour")
    public Object[][] provideWrite_NullBehaviour() {
        return new Object[][] {
                {1, 1, null, "can"},
                {2,3,"RED", null},
                {-2, 2,null, null}
        };
    }
    @Test(dataProvider = "write_NullBehaviour", expectedExceptions = IllegalArgumentException.class)
    public void testPenWrite_NullBehaviour(int inkCV, double sl, String color, String word) throws Exception{
        pen = new Pen(inkCV, sl,color);
        pen.write(word);
    }
    //getColor
    @DataProvider(name = "getColor_retColor")
    public Object[][] provideGetColor_retColor() {
        return new Object[][] {
                {1, 1, "RED"},
                {2,3,"RED"},
                {-2, 2,"BLUE"}
        };
    }

    @Test(dataProvider = "getColor_retColor")
    public void testPenGetColor_retColor(int inkCV, double sl, String color) {
        pen = new Pen(inkCV, sl,color);
        assertEquals("Success", color, pen.getColor());
    }

    //doSmthElse
    @DataProvider(name = "doSmthElse_printColor")
    public Object[][] provideDoSmthElse_printColor() {
        return new Object[][] {
                {1, 1, "RED"},
                {2,3,"RED"},
                {-2, 2,"BLUE"}
        };
    }

    @BeforeMethod(groups = "outPut")
    public void setUpStreams(){
        outContent = new ByteArrayOutputStream();
        outContent.reset();
        System.setOut(new PrintStream(outContent));
    }
    @AfterMethod(groups = "outPut")
    public void restoreStreams() {
        System.setOut(originalOut);
    }

    @Test(dataProvider = "doSmthElse_printColor",groups = "outPut")
    public void testPenDoSmthElse_printColor(int inkCV, double sl, String color) {
        System.setOut(new PrintStream(outContent));
        pen = new Pen(inkCV, sl,color);
        pen.doSomethingElse();
        assertEquals("Success", color+ System.lineSeparator(), outContent.toString());
    }

    //isWork
    @DataProvider(name = "isWork_checkInk")
    public Object[][] provideIsWork_checkInk() {
        return new Object[][] {
                {1, true},
                {2,true},
                {-2, false}
        };
    }

    @Test(dataProvider = "isWork_checkInk")
    public void testPenIsWork_checkInk(int inkCV, boolean res) {
        pen = new Pen(inkCV);
        assertEquals("Success", res, (boolean)pen.isWork());
    }
}
